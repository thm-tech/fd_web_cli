"use strict";define(["angular","app","md5","services/authorization","services/rememberMe"],function(a,b){b.controller("cmLoginCtrl",["$scope","$rootScope","$http","$location","authorization","remember","FileUploader",function(a,b,c,d,e,f,g){document.title="喵喵熊登录";var h=b.proxyUrl,i=h+"/user/login",j=0,k={},l={},m=a.userInfo={},n={},o=a._alert={};a.logSucceed=!0,a.remember=!1;var p={type:"danger"},q="用户名或密码错误!",r="请先退出当前登录用户,重新登录";o.alerts=[],o.alerts.push(p),o.closeAlert=function(a){o.alerts.splice(a,1)},a.changeLoginTab=function(){console.log("mer"),d.path("/merchant/login")};var s=new RegExp("^([a-zA-Z])"),t=function(a){return s.exec(a)?!0:!1},u=function(a,b){t(a)?(k.mode=1,k.account=a):(k.mode=2,k.phone=a),k.password=b,k.dev=returnCitySN.cip,k.type=4},v=function(){var g=h+"/user/personal";console.log("getAccData"),c.get(g).success(function(c){0==c.err&&(console.log("err = 0"),n=c.info,l.accType="cm",l.username=n.name,l.password=m.passwd,l.portrait=n.portrait,a.remember&&(j=30),console.log("usernameeeee,"+n.name),e.setCredentials(l,j),b.globals=f.get("globals")||{},console.log(b.globals),d.path("/customer/account"))}).error()};m.login=function(){if(f.get("globals"))return console.log("globalsssssssssssss"),a.logSucceed=!1,p.msg=r,void(0==o.alerts.length&&o.alerts.push(p));var b=function(b){console.log("post success"),a.logSucceed=!0,0==b.err?(a.logSucceed=!0,a.acc=b,l.userID=b.accID,v()):(console.log("failed,"+b.error_code),a.logSucceed=!1,p.msg=q),0==o.alerts.length&&o.alerts.push(p)},c=function(b){a.err=b};u(m.name,m.passwd),e.login(i,k).success(b).error(c)}}])});