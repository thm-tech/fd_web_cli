Array.prototype.S=String.fromCharCode(2),Array.prototype.in_array=function(a){var b=new RegExp(this.S+a+this.S);return b.test(this.S+this.join(this.S)+this.S)},define(["angular","app","services/checkcookie"],function(a,b){b.controller("shopmsgCtrl",["$scope","$rootScope","$http","$window","$timeout","$q","hascookie",function(a,b,c,d,e,f,g){var h=b.proxyUrl,i=a.user={};a.shopmsgshow=!0,a.$on("openshopmsg",function(b,c){a.shopmsg=c});var j=function(b,c){c?a.$emit(b,c):a.$emit(b)};i.close=function(b){if(void 0!=a.shopmsg.index){var c={index:a.shopmsg.index,scrollTop:a.shopmsg.scrollTop};j("closeshopmsg",c)}else j("closeshopmsg")},i.intoshopdel=function(b,d,f){if(g.check("cm")){var j={shopIDs:[]};c.post(h+"/user/fans/diff",j).success(function(c){fansid=c.addShopIDs;a.isFans=fansid.in_array(b)}),i.scrollTop=$(window).scrollTop(),k(),e(function(){l(b,d,f)},300)}};var k=function(){var c=["../views/customer/account/shopDel/shopDelCtrl"],d=f.defer();require(c,function(){b.$apply(function(){d.resolve()})}),d.promise.then(function(b){a.shopmsgshow=!1,a.shopshow=!0})},l=function(b,c,d){var e={sid:b,sname:c,isFans:a.isFans,idx:d,scrollTop:i.scrollTop};a.$broadcast("intoShop",e)};a.$on("closeShop",function(b,c){a.shopmsgshow=!0,a.shopshow=!1,e(function(){d.scrollTo(0,c.scrollTop)},100)}),i.lettertoshop=function(b){a.$emit("_chatToOwnerChannel",b)}}])});