"use strict";define(["angular","app","md5","services/authorization","services/checkcookie"],function(a,b){b.controller("accountManagement",["$scope","$rootScope","authorization","$http","$modal","FileUploader","$timeout","hascookie",function(a,b,c,d,e,f,g,h){document.title="用户信息 -喵喵熊";var i=b.globals.shop_id,j=b.proxyUrl,k="http://"+b._chatProxyUrl;a.account=b.globals.username,a.resultinfo={},a.resultinfo.yes=!1,a.resultinfo.des="",a.pwd_equal=!0,a.repwd=function(){a.pwd_equal=a.renew_password===a.new_password?!0:!1},a.savepwd=function(b){h.check("mt")&&b&&(console.log(hex_md5(a.old_password)),d({url:j+"/merchant/"+i+"/password",data:{shop_id:i,old_password:hex_md5(a.old_password),new_password:hex_md5(a.new_password)},method:"PUT"}).success(function(b){a.result=b.is_success?"修改成功, 您的密码已经更新":"修改失败, 请确认当前密码输入无误"}),a.modify_password_showtoggle=!0)},a.save=function(b){h.check("mt")&&d({url:j+"/merchant/"+i+"/info",data:{contact_name:a.name,contact_phone_no:a.phone,contact_email:a.email,contact_qq:a.qq,portrait_url:a.portrait_url},method:"POST"}).success(function(c){a.resultinfo.yes=b,a.start_portrait_url!=a.portrait_url&&a.$emit("changeHead",a.portrait_url),a.start_name!=a.name&&a.$emit("changeName",a.name),c.is_success?a.resultinfo.des="修改成功":(l(),a.resultinfo.des="服务器压力山大, 请稍后重试"),g(function(){a.resultinfo.yes=0},3e3)})};var l=function(){d({url:j+"/merchant/"+i+"/info",method:"GET"}).success(function(b){a.name=b.contact_name,a.start_name=a.name,a.phone=b.contact_phone_no,a.email=b.contact_email,a.qq=b.contact_qq,a.portrait_url=b.portrait_url,a.start_portrait_url=b.portrait_url,a.small_portrait_url=b.portrait_url+"@65w_65h.jpg"})};l();var m=a.uploader=new f({url:k+"/file/uploader",autoUpload:!0});m.filters.push({name:"imageFilter",fn:function(a,b){var c="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(c)}}),m.onAfterAddingFile=function(b){console.info("onAfterAddingFile",b),a.is_show=!1,a.inupload=!0},m._onSuccessItem=function(b,c,d,e){console.log("successupload,"+c.url),c.url&&(a.portrait_url=c.url,a.small_portrait_url=c.url+"@100w_100h.jpg",a.save())},m.onCompleteAll=function(){a.inupload=!1}}])});