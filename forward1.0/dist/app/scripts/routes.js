"use strict";define(["angular","app","services/authorization","services/rememberMe"],function(a,b){return b.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){var d={load:["$q","$rootScope","$location",function(a,b,c){var d="",e=[],f=c.path();console.log("the path is "+f);var g=f.indexOf("?"),h=-1!=g?f.substring(0,g).split("/"):f.split("/"),i=h.length;if(console.log("routeDep,"+i+h[0]+","+h[1]),"index"==h[1]?(e.push("../views/platform/downloadCtrl"),d="../views/platform/platformCtrl"):3==i?(console.log("333333333333"),"account"==h[2]&&(e.push("../views/"+h[1]+"/account/accountCtrl"),e.push("../views/"+h[1]+"/account/chatroom/chatroomCtrl")),d="../views/"+h[1]+"/"+h[2]+"/"+h[2]+"Ctrl"):4==i&&(e.push("../views/"+h[1]+"/account/accountCtrl"),e.push("../views/"+h[1]+"/account/chatroom/chatroomCtrl"),d="../views/"+h[1]+"/account/"+h[3]+"/"+h[3]+"Ctrl",console.log("CtrlPathhhhhhhhhhhhhhh,"+d)),d){e.push(d),console.log("the loadCtrl0 is,"+e[0]);var j=a.defer();return require(e,function(){b.$apply(function(){j.resolve()})}),j.promise}}]};b.otherwise("/index"),b.when("/customer/account","customer/account/shops"),a.state("index",{url:"/index",views:{"":{templateUrl:"../views/platform/home.html",resolve:d},"main@index":{templateUrl:"../views/platform/main.html"}},auth:!0}).state("index.module",{url:"/:module",views:{"module@index":{templateUrl:function(a){return a.module?"../views/platform/"+a.module+".html":"../index.html"}}},auth:!0}).state("cmlogin",{url:"/customer/login",templateUrl:"../views/customer/login/login.html",resolve:d,auth:!0}).state("mtlogin",{url:"/merchant/login",templateUrl:"../views/merchant/login/login.html",resolve:d,auth:!0}).state("cmreset",{url:"/customer/resetPsw",templateUrl:"../views/customer/resetPsw/resetPsw.html",resolve:d,auth:!0}).state("mtreset",{url:"/merchant/resetPsw",templateUrl:"../views/merchant/resetPsw/resetPsw.html",resolve:d,auth:!0}).state("cmregister",{url:"/customer/cmregister",templateUrl:"../views/customer/cmregister/cmregister.html",resolve:d,auth:!0}).state("cmaccount",{url:"/customer/account",views:{"":{templateUrl:"../views/customer/account/account.html"},"chat@cmaccount":{templateUrl:"../views/customer/account/chatroom/chatroom.html",resolve:d}},auth:!1}).state("cmaccount.module",{url:"/:module?city&w&page",views:{"function@cmaccount":{templateUrl:function(a){console.log("sp.module,"+a.module);var b=a.module.indexOf("?"),c=-1!=b?a.module.substring(0,b):a.module;return"../views/customer/account/"+c+"/"+c+".html"},resolve:d}},auth:!1}).state("mtaccount",{url:"/merchant/account",views:{"":{templateUrl:"../views/merchant/account/account.html"},"chat@mtaccount":{templateUrl:"../views/merchant/account/chatroom/chatroom.html",resolve:d},"noservice@mtaccount":{templateUrl:"../views/merchant/account/noservice/noservice.html"}},auth:!1}).state("mtaccount.module",{url:"/:module",views:{"function@mtaccount":{templateUrl:function(a){return"../views/merchant/account/"+a.module+"/"+a.module+".html"},resolve:d}},auth:!1}).state("mtaccount.module.submodule",{url:"/:submodule",views:{submodule:{templateUrl:function(a){return console.log("type,"+typeof a.submodule),"../views/merchant/account/"+a.module+"/"+a.submodule+"/"+a.submodule+".html"},resolve:d}},auth:!1}).state("404",{url:"/404",templateUrl:"../404.html",auth:!0})}]).run(["$rootScope","$state","$location","$http","remember","$timeout","$q","authorization",function(a,b,c,d,e,f,g,h){var i=a.proxyUrl;a.globals=e.get("globals")||{},console.log("now is,"+a.globals.username),a.$on("$stateChangeStart",function(f,j,k,l,m){var n=document.location.href,o=n.match("code=\\w+"),p=n.match("name=[^&]+");if(p){var q=p[0].split("=")[1];q=decodeURIComponent(q);var r=n.match("gender=\\d+"),s=r[0].split("=")[1],t=n.match("portraitUrl=[^&]+"),u=t[0].split("=")[1],v=n.match("access_token=\\w+"),w=(v[0].split("=")[1],n.match("openid=\\w+")),x=w[0].split("=")[1];d({url:i+"/user/loginex",method:"POST",data:{mode:5,type:4,openID:x,dev:""}}).success(function(b){var f=b.isReg,g=b.accID;console.log("third login result data",b),b.err||(console.log("third login success"),f?(d({url:i+"/user/personal",method:"POST",data:{attr:1,name:q}}).success(function(a){console.log("modify user name in immbear result",a)}),d({url:i+"/user/personal",method:"POST",data:{attr:3,gender:s}}).success(function(a){console.log("modify user name in immbear result",a)}),d({url:i+"/userweb/quickmodifyimg",method:"PUT",data:{user_id:g,url:u}}).success(function(b){console.log("modify user imgurl success",b);var d={userID:g,accType:"cm",username:q,password:x,portrait:b.url};h.setCredentials(d,30),a.globals=e.get("globals")||{},c.path("/customer/account")}),console.log("------------------------------END")):d({url:i+"/user/personal",method:"GET"}).success(function(b){var d=b,f={userID:g,accType:"cm",username:d.info.name,password:x,portrait:d.info.portrait};h.setCredentials(f,30),a.globals=e.get("globals")||{},c.path("/customer/account")}))})}else if(o){var y=o[0].split("=")[1];d({url:i+"/thirdlogin/wechat?code="+y,method:"GET"}).success(function(b){if(b.errcode)console.log("errcode",b);else{var f=b.access_token,g=b.openid;console.log("access_token",f),console.log("open_id",g),d({url:i+"/user/loginex",method:"POST",data:{mode:5,type:4,openID:g,dev:""}}).success(function(b){var j=b.isReg,k=b.accID;console.log("third login result data",b),b.err||(console.log("third login success"),d({url:i+"/thirdlogin/wechat/info?access_token="+f+"&openid="+g,method:"GET"}).success(function(b){var f=b;if(console.log("get wechat info success",b),j){var l={userID:k,accType:"cm",username:f.nickname,password:g,portrait:f.headimgurl};h.setCredentials(l,30),a.globals=e.get("globals")||{},console.log("--------------------------------"),console.log(k,f),console.log("--------------------------------"),c.path("/customer/account"),d({url:i+"/user/personal",method:"POST",data:{attr:1,name:b.nickname}}).success(function(a){console.log("modify user name in immbear result",a)}),d({url:i+"/user/personal",method:"POST",data:{attr:3,gender:b.sex}}).success(function(a){console.log("modify user name in immbear result",a)}),d({url:i+"/userweb/quickmodifyimg",method:"PUT",data:{user_id:k,url:f.headimgurl}}).success(function(a){console.log("modify user imgurl success",a)}),console.log("------------------------------END")}else d({url:i+"/user/personal",method:"GET"}).success(function(b){var d=b,f={userID:k,accType:"cm",username:d.info.name,password:g,portrait:d.info.portrait};h.setCredentials(f,30),a.globals=e.get("globals")||{},c.path("/customer/account")})}))})}})}else if(j.auth||e.get("globals")){if(!j.auth&&e.get("globals")){var z=c.path().split("/")[1];"cm"==e.get("globals").accType&&"merchant"==z?(h.clearCredentials(),d({url:i+"/user/logout",method:"POST",data:{}}).success(function(a){}).error(function(){}),c.path("/merchant/login")):"mt"==e.get("globals").accType&&"customer"==z&&(h.clearCredentials(),d({url:i+"/merchant/logout",method:"POST",data:{}}).success(function(a){}).error(function(){}),c.path("/customer/login"))}}else{console.log("loginnnnnnnnn"),console.log(j),console.log(k),console.log(c.path()),f.preventDefault();var A=g.defer(),B=["../views/customer/login/loginCtrl"];require(B,function(){a.$apply(function(){A.resolve()})}),A.promise.then(function(a){b.go("cmlogin")})}}),a.$on("$stateChangeSuccess",function(b,d,f,g,h){if(d.auth&&e.get("globals")){console.log("herehere"),a.globals=e.get("globals");var i=e.get("globals").accType,j=c.path(),k=j.split("/"),l=k.length;(2==l||"login"===k[2])&&(console.log("22222222222"),"cm"==i?c.path("/customer/account"):"mt"==i&&c.path("/merchant/account"))}})}])});